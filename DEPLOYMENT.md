# DNA Hub - Deployment Guide

This application can be deployed in two ways:

## üè† Local Docker Development

For local development and testing without domain requirements.

### Prerequisites
- Docker and Docker Compose installed
- Port 3013 available

### Quick Start
```bash
# Make script executable
chmod +x docker-local.sh

# Full setup (first time)
./docker-local.sh setup

# Or step by step
./docker-local.sh build
./docker-local.sh start
./docker-local.sh init
./docker-local.sh admin
```

### Access
- **URL**: http://localhost:3013
- **Admin Email**: admin@dna.com
- **Admin Password**: admin123
- **Dashboard**: http://localhost:3013/en/dashboard

### Local Commands
```bash
./docker-local.sh setup     # Full setup for first time
./docker-local.sh start     # Start application
./docker-local.sh stop      # Stop application
./docker-local.sh restart   # Restart application
./docker-local.sh logs      # View logs
./docker-local.sh status    # Show status
./docker-local.sh help      # Show help
```

---

## üåê Server Deployment (Production)

For production deployment with domain and SSL certificate.

### Prerequisites
- Server with Docker and Docker Compose
- Domain name pointing to your server IP
- Ports 80 and 443 open in firewall
- DNS A record: `dna.sbc.om ‚Üí Your Server IP`

### Quick Start
```bash
# Make script executable
chmod +x deploy-server.sh

# Full deployment
./deploy-server.sh deploy
```

### Server Access
- **URL**: https://dna.sbc.om
- **Admin Email**: admin@dna.com
- **Admin Password**: admin123
- **Dashboard**: https://dna.sbc.om/en/dashboard

### Server Commands
```bash
./deploy-server.sh deploy    # Full deployment
./deploy-server.sh proxy     # Start nginx proxy only
./deploy-server.sh build     # Build Docker image
./deploy-server.sh start     # Start application
./deploy-server.sh stop      # Stop application
./deploy-server.sh restart   # Restart application
./deploy-server.sh logs      # View logs
./deploy-server.sh status    # Show status
./deploy-server.sh help      # Show help
```

### Important Notes for Server Deployment

1. **Change Security Settings**:
   Edit `docker-compose.yml` and change:
   ```yaml
   JWT_SECRET: your-super-secret-jwt-key-change-this-in-production
   CRON_SECRET: your-cron-secret-change-this
   ```

2. **DNS Configuration**:
   - Set A record: `dna.sbc.om` ‚Üí Your server IP
   - Wait for DNS propagation (can take up to 24 hours)

3. **Firewall**:
   ```bash
   # Ubuntu/Debian
   sudo ufw allow 80
   sudo ufw allow 443
   
   # CentOS/RHEL
   sudo firewall-cmd --permanent --add-port=80/tcp
   sudo firewall-cmd --permanent --add-port=443/tcp
   sudo firewall-cmd --reload
   ```

4. **SSL Certificate**:
   - Automatically generated by Let's Encrypt
   - Takes 1-2 minutes after deployment
   - Valid for 90 days, auto-renewed

---

## üìä Configuration Differences

| Feature | Local Docker | Server Deployment |
|---------|-------------|-------------------|
| **URL** | http://localhost:3013 | https://dna.sbc.om |
| **SSL** | No | Yes (Let's Encrypt) |
| **Domain** | Not required | Required |
| **Memory** | 2GB limit | 4GB limit |
| **LMDB** | 128MB | 256MB |
| **Proxy** | No | Nginx Proxy |
| **Port** | 3013 | 3013 (proxied) |

---

## üîß Development vs Production

### Local Development
- Uses `docker-compose.local.yml`
- No SSL/domain requirements
- Lower resource limits
- Direct port access
- Development-friendly settings

### Production Server
- Uses `docker-compose.yml`
- SSL certificate required
- Higher resource limits  
- Nginx proxy with Let's Encrypt
- Production security settings

---

## üö® Troubleshooting

### Local Issues
```bash
# Check if port is in use
lsof -i :3013

# View container logs
./docker-local.sh logs

# Restart everything
./docker-local.sh stop
./docker-local.sh start
```

### Server Issues
```bash
# Check DNS
nslookup dna.sbc.om

# Check SSL certificate
./deploy-server.sh logs

# Check proxy status
./deploy-server.sh status
```

### Common Problems

1. **Port already in use**:
   ```bash
   # Kill process using port
   sudo lsof -ti :3013 | xargs kill -9
   ```

2. **Memory issues**:
   - Increase Docker memory limits
   - Check available system memory

3. **Database issues**:
   ```bash
   # Reset database
   ./docker-local.sh stop
   rm -rf data/lmdb/*
   ./docker-local.sh start
   ./docker-local.sh init
   ```

---

## üìÅ File Structure

```
‚îú‚îÄ‚îÄ docker-local.sh           # Local Docker management
‚îú‚îÄ‚îÄ deploy-server.sh          # Server deployment  
‚îú‚îÄ‚îÄ docker-compose.local.yml  # Local configuration
‚îú‚îÄ‚îÄ docker-compose.yml        # Server configuration
‚îú‚îÄ‚îÄ Dockerfile               # Container build file
‚îî‚îÄ‚îÄ SERVER/                  # Nginx proxy config
    ‚îî‚îÄ‚îÄ docker-compose.yml
```

---

## üîê Security Notes

- Change default JWT secrets in production
- Use strong passwords for admin accounts
- Keep Docker and system updated
- Monitor logs for suspicious activity
- Backup database regularly

---

## üìà Monitoring

### Health Checks
- Local: http://localhost:3013/api/health
- Server: https://dna.sbc.om/api/health

### Resource Usage
```bash
# Check container stats
docker stats

# Check disk usage
df -h
```